#!/usr/bin/env perl
use warnings;
use strict;
use lib '/usr/local/lib/perl5';
use Computer::Battery;

my $battery = Computer::Battery->new(
);

while (1) {
    $battery->read_state;
    my $capacity = $battery->get_remaining_capacity;
    my $state = $battery->get_state;
    print "=> $state, $capacity <=\n";
    sleep 10;
    if ( ($capacity <= 3000) && ( $state ne "charging"  ) ) {
     	system("sudo halt");
    }
}
